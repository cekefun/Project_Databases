<!DOCTYPE html>
<html>
<head>
{% load staticfiles %}
<link rel="stylesheet" type="text/css" href="{% static 'css/defaultstyle.css' %}">
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart', 'controls','timeline']});
      google.charts.setOnLoadCallback(drawStuff);

      function drawStuff() {

        var dashboard = new google.visualization.Dashboard(
          document.getElementById('programmatic_dashboard_div'));

        programmaticSlider = new google.visualization.ControlWrapper({
          'controlType': 'ChartRangeFilter',
          'containerId': 'programmatic_control_div',
          'options': {
            'filterColumnIndex': '0',
            'ui': {'labelStacking': 'Vertical'}
          }
        });



      function getdata() {
	var jsonhttp = new XMLHttpRequest();
	var url = "current/";
	jsonhttp.onreadystatechange = function() {
		if (jsonhttp.readyState == 4 && jsonhttp.status == 200) {
			var minutedata = JSON.parse(jsonhttp.responseText);
			// function here with minutedata
		}
	}
	jsonhttp.open("GET", url, true);
	jsonhttp.send();
	console.log(document);
      }
      window.onload = getdata;



  
//      var data = new google.visualization.DataTable();
//	data.addColumn('datetime', 'Time');
//    	data.addColumn('number', 'Electric shower');
//	data.addColumn('number', 'Microwave');
//	data.addColumn('number', 'Lamp1');
//	data.addColumn('number', 'Lamp2');
//	data.addColumn('number', 'Oven');
//	data.addColumn('number', 'Tesla coil');
//	data.addColumn('number', 'fusion furnace');
//
//	data.addRows([
//      [new Date(2016, 0, 1, 1, 1),      	   		120,	     190,    	400,    700,   1000, 	 20000,    	900       ],
//      [new Date(2016, 0, 1, 1, 2),      	   		170,         240,    	 0,     600,   100,    	 50000,    	900       ],
//      [new Date(2016, 0, 1, 1, 3),      	   		300, 	     300,    	 0,     600,   100,    	 30000,     	1000      ],
//      [new Date(2016, 0, 1, 1, 4),      	   		500,   	     300,      	 0,      0,    100,      25000,    	4500      ],
//      [new Date(2016, 0, 1, 1, 5),      	   		500,         360,    	650,     0,    1000,   	 30000,  	3500      ],
//      [new Date(2016, 0, 1, 1, 6),      	   		1000,  	     1000,   	600,    800,   1000,  	 50000, 	10000     ],
//      [new Date(2016, 0, 1, 1, 7),      	   		1000,        766,    	400,    800,   900,	 10000,    	7000      ],
//	[new Date(2016, 0, 1, 1, 8),      	   		800,	     700,	400,    700,   1000,     50000,		7000      ],
//	[new Date(2016, 0, 1, 1, 9),      	   		500,	     600,       400,    600,   1000,     45000,   	6500  	  ],
//	[new Date(2016, 0, 1, 1, 10),    	    		70,   	     60,	0,	600,   50,	 15000,		3000 	  ],
//
//    ]);

	var columnsTable = new google.visualization.DataTable();
    	columnsTable.addColumn('number', 'colIndex');
    	columnsTable.addColumn('string', 'colLabel');
    	var initState= {selectedValues: []};
    	// put the columns into this data table (skip column 0 and 1)
    	for (var i = 1; i < data.getNumberOfColumns(); i++) {
        	columnsTable.addRow([i, data.getColumnLabel(i)]);
    	}
    	for (var i = 1; i < data.getNumberOfColumns(); i++) {
        	initState.selectedValues.push(data.getColumnLabel(i));
    	}

       programmaticChart  = new google.visualization.ChartWrapper({
        'chartType': 'LineChart',
        'containerId': 'programmatic_chart_div',
	 dataTable: data,
        'options': {
          'width': 1500,
          'height': 700,
          'legend': {position : 'right'},
        }
      });



    var columnFilter = new google.visualization.ControlWrapper({
        controlType: 'CategoryFilter',
        containerId: 'colFilter_div',
        dataTable: columnsTable,
        options: {
            filterColumnLabel: 'colLabel',
            ui: {
                label: ' ',
                allowTyping: false,
                allowMultiple: true,
                allowNone: false,
                selectedValuesLayout: 'belowStacked'
            }
        },
        state: initState
    });

    function setChartView () {
        var state = columnFilter.getState();
        var row;
        var view = {
            columns: [0]
        };
        for (var i = 0; i < state.selectedValues.length; i++) {
            row = columnsTable.getFilteredRows([{column: 1, value: state.selectedValues[i]}])[0];
            view.columns.push(columnsTable.getValue(row, 0));
        }
        // sort the indices into their original order
        view.columns.sort(function (a, b) {
            return (a - b);
        });
        programmaticChart.setView(view);
        programmaticChart.draw();
    }
    google.visualization.events.addListener(columnFilter, 'statechange', setChartView);
 

    setChartView();
    columnFilter.draw();
      dashboard.bind(programmaticSlider, programmaticChart, columnFilter);
      dashboard.draw(data);
    }

</script>

</head>
<body>
<ul1>
  <li1 style=float:left;><a href="../">Start</a></li1>
  <li1><a href="../sensors/">Sensoren</a></li1>
  <li1><a class="active" href="">Energieverbruik</a></li1>
  {% if request.session.IsAdmin %}
  <li1><a href="../../admin/users">Gebruikers</a></li1>
  <li1><a href="../../admin/report">Verskag</a></li1>
  {% endif %}
  <li1><a href="../about/">Over</a></li1>
</ul1>
<ul2>
  <li2 style=float:left;><a href="../minute/">Minuutverbruik</a></li2>
  <li2><a class="active" href="">Uurverbruik</a></li2>
  <li2><a href="../day/">Dagverbruik</a></li2>
  <li2><a href="../week/">Weekverbruik</a></li2>
  <li2><a href="../month/">Maandverbruik</a></li2>
  <li2><a href="../year/">Jaarverbruik</a></li2>
</ul2>
<div class="dropdown" >
<button class="dropbtn" style="float:right">Account</button>
  <div class="dropdown-content a">
      <a href="../settings/">Instellingen</a>
      <a href="../addHouse/">Voeg huis toe</a>
      <a href="/logout/">Log uit</a>
	</div>
</div>
<br><br><br><br><br><br>

    <div id="programmatic_dashboard_div" style="padding-top:80px ;border: 1px solid #ccc">
      <table class="columns">
        <tr>
          <td>

            <div id="programmatic_chart_div" ></div>

          </td>
	  <td>
		<div id="colFilter_div"></div>
	  </td>

        </tr>
          <td>
            <div id="programmatic_control_div" style="padding-left: 200px;min-width: 1100px; min-height: 80px"></div>
          </td>
      </table>
    </div>
</body>
</html>
